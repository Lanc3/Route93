generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int        @id @default(autoincrement())
  email               String     @unique
  name                String
  phone               String?
  role                String     @default("CLIENT")
  hashedPassword      String     @default("")
  salt                String     @default("")
  resetToken          String?
  resetTokenExpiresAt DateTime?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  addresses           Address[]
  cartItems           CartItem[]
  orders              Order[]
  reviews             Review[]

  @@map("users")
}

model Product {
  id          Int                 @id @default(autoincrement())
  name        String
  description String?
  price       Float
  salePrice   Float?
  sku         String              @unique
  slug        String              @unique
  status      String              @default("ACTIVE")
  inventory   Int                 @default(0)
  images      String?
  tags        String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  categoryId  Int?
  cartItems   CartItem[]
  orderItems  OrderItem[]
  collections ProductCollection[]
  category    Category?           @relation(fields: [categoryId], references: [id])
  reviews     Review[]

  @@map("products")
}

model Category {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  slug        String     @unique
  parentId    Int?
  image       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  products    Product[]

  @@map("categories")
}

model Collection {
  id          Int                 @id @default(autoincrement())
  name        String
  description String?
  slug        String              @unique
  image       String?
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  products    ProductCollection[]

  @@map("collections")
}

model ProductCollection {
  id           Int        @id @default(autoincrement())
  productId    Int
  collectionId Int
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, collectionId])
  @@map("product_collections")
}

model Order {
  id                Int         @id @default(autoincrement())
  orderNumber       String      @unique
  status            String      @default("PENDING")
  totalAmount       Float
  shippingCost      Float       @default(0)
  taxAmount         Float       @default(0)
  notes             String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  userId            Int
  shippingAddressId Int
  billingAddressId  Int
  orderItems        OrderItem[]
  billingAddress    Address     @relation("BillingAddress", fields: [billingAddressId], references: [id])
  shippingAddress   Address     @relation("ShippingAddress", fields: [shippingAddressId], references: [id])
  user              User        @relation(fields: [userId], references: [id])
  payments          Payment[]

  @@map("orders")
}

model OrderItem {
  id         Int     @id @default(autoincrement())
  quantity   Int
  price      Float
  totalPrice Float
  orderId    Int
  productId  Int
  order      Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model CartItem {
  id        Int      @id @default(autoincrement())
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    Int
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("cart_items")
}

model Address {
  id             Int      @id @default(autoincrement())
  firstName      String
  lastName       String
  company        String?
  address1       String
  address2       String?
  city           String
  state          String
  zipCode        String
  country        String   @default("US")
  phone          String?
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  userId         Int
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders  Order[]  @relation("BillingAddress")
  shippingOrders Order[]  @relation("ShippingAddress")

  @@map("addresses")
}

model Payment {
  id            Int      @id @default(autoincrement())
  amount        Float
  status        String   @default("PENDING")
  method        String
  transactionId String?
  errorCode     String?
  errorMessage  String?
  errorType     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  orderId       Int
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Review {
  id         Int      @id @default(autoincrement())
  rating     Int
  title      String?
  comment    String?
  isVerified Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  userId     Int
  productId  Int
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("reviews")
}
